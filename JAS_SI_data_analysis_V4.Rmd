---
title: 'Seminoff EPac green turtle Stable Isotope Data Analysis'
author: "Lisa Komoroske"
date: '`r Sys.Date()`'
output: word_document
---
##Metadata from Jeff
**Site** - an ordinal code for each site  
**Site code** - 3 letter code for each site  
**Ordered_SITE** - combined site code with ordered # roughly North to South for graphing ordering
**Location_Label** - shortened location names for graphing labeling purposes
**Location** - location of turtle capture  
**LAB ID** - self explanatory  
**Collection Date** - self explanatory  
**Run Date** - self explanatory  
**%N** - elemental concentration of N.  that is, how much each sample is made up of nitrogen.  this is used as a diagnostic to know sample quality (anything outside of ~9-17% N raises a red flag)  
**%C** - elemental concentration of C.  that is, how much each sample is made up of carbon.  this is used as a diagnostic to know sample quality (anything outside of ~40-60% C raises a red flag)  
**d15N** - stable isotope value for N  
**d13C** - stable isotope value for C  
**Color** - rarely filled in. This is largely for the Galapagos and Colombia, where black turtles (eastern Pacific stock) and yellow turtles (west Pacific origins) co-exist.  Safe to say that anything that is not filled in here would be a ‘black’ morph.  
**SCL** - straight carapace length 
**CCL_calc_fromSCL** - used formula from Seminoff et al. 2003 to interpolate CCLs from SCLs
**CCL_empirical** - curved carapace length-these are only the empirically collected values
**CCL_combined** - curved carapace length-I pasted over all the empirical values, and then for ones that were missing empirical CCL but had **CCL_calc_fromSCL**, I added these in; so this is the combined variable that we'll use for size relationships

Plan for figures:  
1. Carbon Histogram by Site  
2. Nitrogen Histogram by Site  
3. Boxplots, 2 panel (C then N)  
4. Ellipses  
5. Whisker plot (C vs. N)  
6. Map-large with insets of regions  

##Setup
```{r setup, echo=FALSE,include=FALSE}
setwd("~/EPGT_stable_isotope_analysis")
getwd()
```

##Load Required Libraries
```{r libraries, echo=FALSE, include=FALSE}
library(ggplot2)
library(plyr)
library(RColorBrewer)#can also use palettes, etc. l=defines darkness/lightness of colors see R graphics cookbook pgs255-263
#additional code and plots from Latimer class for data QC and exploration:####
library(MASS); library(lattice)
library(lme4); library(lmerTest);library(car)
```

##Read in data
```{r read_data, echo=FALSE,include=FALSE}
data<-read.csv("CM Isotope Data UPDATED.csv")
#updated 12-20-16 summary files reading in here to reflect new groupings, excluded data etc.
data$Ordered_SITE<-factor(data$Ordered_SITE, levels =c("1-SGR_SBN","3-SDB","4-NGU","6-BMA","7-IPD","8-LOR","9-BLA","11-CIN", "13-DUL","14-PAR","15-MEJ","16-ISL","17-COC","18-GOR","19-IGP","20-IGE","21-IGD","22-IGZ","23-IGN","24-PPE"))

#12-19-16 added: removing problematic sites and questionable values
data_new<-subset(data, Ordered_SITE!="7-IPD" &Ordered_SITE!="8-LOR"&Ordered_SITE!="16-ISL"&Ordered_SITE!="22-IGZ"&Ordered_SITE!="23-IGN")
data_new<-subset(data_new, Percent_N>=5 | is.na(data_new$Percent_N) )
data_new<-subset(data_new, Percent_N<=20 | is.na(data_new$Percent_N) )
data_new$Collect_Date <- strptime(data_new$Collect_Date, "%m/%d/%Y")
data_new$Run_Date <- strptime(data_new$Run_Date, "%m/%d/%Y")
palette<-c("firebrick","forestgreen","deepskyblue3","purple","orange")
data_new2<-subset(data_new,Habitat_Type!="oceanic") #exclude oceanic site
data<-data_new

data_Nsum<-read.csv("EPGT_d15Nsumc_LKedit.csv")
str(data_Nsum) 
data_Csum<-read.csv("EPGT_d13Csumc_LKedit.csv")
str(data_Csum)
```

##Coarse data QC checks to note obvious data structure problems, etc.:
```{r initial_QC, echo=TRUE}
#see version 1 for more in depth QC checks
summary(data)
data$Ordered_SITE<-factor(data$Ordered_SITE)#reset variable to get rid of excluded sites in count
table(data$Ordered_SITE) #frequency table
```

##Figures  
####1. Faceted Histograms
```{r histogram_fig, echo=TRUE}
levels(data$Location_Label)
#come back and remake with codes in parentheses(?)
data$Location_Label<-factor(data$Location_Label, levels =c(
"Long Beach, USA", "Bahia de los Angeles, GoC, MX", "Isla Gorgona, Colombia" ,"Oceanic Waters, Peru (Longline)",
"San Diego Bay, USA", "Infiernillo Channel, GoC, MX" , "Bahia Elizabeth, Isabela, Galapagos","Pisco / Paracas Bay, Peru" ,
"North Gulf of Ulloa, BCS, MX", "Golfo Dulce, Costa Rica", "Caleta Derek, Isabela, Galapagos","Mejillones, Chile" ,
"Bahia Magdalena, BCS, MX", "Cocos Island, Costa Rica" , "Puta Espinosa, Fernandina, Galapagos"))
C<-ggplot(data, aes(x=d13C)) + geom_histogram(alpha=.4, fill="yellow",colour="black")+theme_bw()+
geom_vline(aes(xintercept=mean(d13C, na.rm=T)),    #Ignore NA values for mean
           color="red", linetype="dashed", size=0.5)
pdf("carbon_faceted_histogram.pdf", 12, 5)
C+facet_wrap( ~ Location_Label, ncol=4)
dev.off()

N<-ggplot(data, aes(x=d15N)) + geom_histogram(alpha=.4, fill="forest green",colour="black")+theme_bw()+
geom_vline(aes(xintercept=mean(d15N, na.rm=T)),    #Ignore NA values for mean
           color="red", linetype="dashed", size=0.5)
pdf("nitrogen_faceted_histogram.pdf", 12, 5)
N+facet_wrap( ~ Location_Label, ncol=4)
dev.off()
```

####2. Boxplots, 2 panel (C then N)  
```{r boxplots, echo=TRUE}
data$Region<-factor(data$Region,levels=c("SC-BC Pac Coast","Gulf of Cal","Cen-SoAm Pac Coast" , "Oceanic" , "EPac Islands"))
reg_palette<-c("forest green","red", "purple","deepskyblue3","orange")

levels(data$Ordered_SITE)
#for bottom to top order
data$Ordered_SITE<-factor(data$Ordered_SITE,levels=c("1-SGR_SBN" ,"3-SDB",     "4-NGU" ,    "6-BMA" ,    "9-BLA"  ,   "11-CIN" ,   "13-DUL"  ,"14-PAR", "15-MEJ","24-PPE" ,"17-COC", "18-GOR",  "20-IGE" ,   "21-IGD"   ,"19-IGP" ))

#for top to bottom order
data$Ordered_SITE<-factor(data$Ordered_SITE,levels=c("19-IGP","21-IGD","20-IGE","18-GOR","17-COC","24-PPE","15-MEJ","14-PAR","13-DUL","11-CIN","9-BLA","6-BMA","4-NGU","3-SDB","1-SGR_SBN"))

pdf("nitrogen_boxplot.pdf", 8, 5)
ggplot(data, aes(y=d15N, x=Ordered_SITE,fill=Region)) + 
  geom_boxplot(outlier.shape = 1,width=0.75) +theme_bw()+ guides(fill=FALSE)+
  theme(panel.grid.major.x=element_blank(),
        panel.grid.minor.x=element_blank(),
        panel.grid.major.y=element_line(colour="grey60",linetype="dashed"))+ scale_fill_manual(values=reg_palette,guide=FALSE)+xlab("Location ") +ylab("d15N") +coord_flip(ylim = c(5, 22))
dev.off()

pdf("carbon_boxplot.pdf", 8, 5)
ggplot(data, aes(y=d13C, x=Ordered_SITE,fill=Region)) + 
  geom_boxplot(outlier.shape = 1,width=0.75) +theme_bw()+ guides(fill=FALSE)+
  theme(panel.grid.major.x=element_blank(),
        panel.grid.minor.x=element_blank(),
        panel.grid.major.y=element_line(colour="grey60",linetype="dashed"))+ scale_fill_manual(values=reg_palette,guide=FALSE)+xlab("Location ") +ylab("d13C")+coord_flip()
dev.off()

```

####3. Ellipses  
[stat_ellipse function info][1]  
*notes say 'group by region 95% CI's, but not sure if mean ellipes by region or faceting by region, so doing both for now*
```{r CvsN_ellipses, echo=TRUE}
data_new2$Region<-factor(data_new2$Region,levels=c("SC-BC Pac Coast","Gulf of Cal","Cen-SoAm Pac Coast" , "EPac Islands"))
reg_palette1<-c("forest green","red", "purple","orange")
pal1<-c("yellow","deepskyblue","forestgreen","red","deepskyblue","yellow","deepskyblue","yellow","red","yellow","deepskyblue","red","forestgreen", "grey80")
data_new2$Ordered_SITE<-factor(data_new2$Ordered_SITE)

pdf("ellipse_facet1.pdf", 8, 5)
#with data points and ellipse for each site by region-points on top
levels(data_new2$Ordered_SITE)
ggplot(data_new2, aes(x=d13C,y=d15N)) +
  stat_ellipse(geom="polygon",alpha=.5, aes(fill=Ordered_SITE),color="black")+ geom_point(size=3, alpha=.8,shape=21,position=position_jitter(width=.5,height=.5),aes(fill=Ordered_SITE))+theme_bw()+theme(axis.text.x  = element_text(angle=0, vjust=0.5))+scale_fill_manual(values=pal1)+facet_wrap( ~ Region, ncol=2)
dev.off()

pdf("ellipse_facet2.pdf", 8, 5)
#with data points and ellipse for each site by region-points on bottom
ggplot(data_new2, aes(x=d13C,y=d15N)) +
   geom_point(size=3, alpha=.8,shape=21,position=position_jitter(width=.5,height=.5),aes(fill=Ordered_SITE))+theme_bw()+theme(axis.text.x  = element_text(angle=0, vjust=0.5))+
stat_ellipse(geom="polygon",alpha=.5, aes(fill=Ordered_SITE),color="black")+scale_fill_manual(values=pal1)+facet_wrap( ~ Region, ncol=2)
dev.off()

pdf("ellipse_facet3.pdf", 8, 5)
#with just ellipse for each site by region 
ggplot(data_new2, aes(x=d13C,y=d15N)) + theme_bw()+theme(axis.text.x  = element_text(angle=0, vjust=0.5))+
  stat_ellipse(geom="polygon",alpha=.5, aes(fill=Ordered_SITE),color="black")+scale_fill_manual(values=pal1)+facet_wrap( ~ Region, ncol=2)
dev.off()

pdf("ellipse_region1.pdf", 8, 5)
#with data and ellipse for each region-point on top
ggplot(data_new2, aes(x=d13C,y=d15N)) +
  stat_ellipse(geom="polygon",alpha=.6, aes(fill=Region),color="black")+ 
  geom_point(size=3, alpha=.9,shape=21,position=position_jitter(width=.5,height=.5),aes(fill=Region))+theme_bw()+theme(axis.text.x  = element_text(angle=0, vjust=0.5))+scale_fill_manual(values=reg_palette1)
dev.off()

pdf("ellipse_region2.pdf", 8, 5)
#with data and ellipse for each region-point on bottom
ggplot(data_new2, aes(x=d13C,y=d15N)) +geom_point(size=3, alpha=.9,shape=21,position=position_jitter(width=.5,height=.5),aes(fill=Region))+
  stat_ellipse(geom="polygon",alpha=.6, aes(fill=Region),color="black") +
  theme_bw()+theme(axis.text.x  = element_text(angle=0, vjust=0.5))+scale_fill_manual(values=reg_palette1)
dev.off()

pdf("ellipse_region3.pdf", 8, 5)
#with just ellipse for each region
ggplot(data_new2, aes(x=d13C,y=d15N, fill=Region)) + theme_bw()+theme(axis.text.x  = element_text(angle=0, vjust=0.5))+scale_fill_manual(values=reg_palette1)+
   stat_ellipse(geom="polygon",alpha=.6, aes(fill=Region),color="black")#default settings assume multivariate t distribution and 0.95 CI
dev.off()
```

####4. Whiskers  
```{r CvsN_whisker, echo=TRUE}

CNsum_merge<-merge(data_Csum,data_Nsum)
CNsum_merge$SITENS<-paste(CNsum_merge$N_to_S_ordination, "-",CNsum_merge$Ordered_SITE)
CNsum_merge$SITENS
CNsum_merge$SITENS<-factor(CNsum_merge$SITENS,levels= c("1 - MEJ","2 - PAR","3 - PPE" ,"6 - IGD",
"7 - IGE","8 - IGP","9 - GOR", "10 - COC", "11 - DUL","13 - BMA", "16 - NGU" ,"18 - CIN","19 - BLA","20 - SDB","21 - SGR_SBN")) 

CNsum_merge$Region<-factor(CNsum_merge$Region,levels=c("SC-BC Pac Coast","Gulf of Cal","Cen-SoAm Pac Coast" , "Oceanic" , "EPac Islands"))

pdf("C vs. N Whisker plot.pdf", 8, 5)
ggplot(CNsum_merge, aes(x=mean_d13C,y=mean_d15N,fill=Region)) +
  geom_errorbar(aes(ymin=mean_d15N-se_d15N,ymax=mean_d15N+se_d15N),size=0.25)+
  geom_errorbarh(aes(xmin=mean_d13C-se_d13C,xmax=mean_d13C+se_d13C),size=0.25)+
  geom_point(size=3, alpha=.9,shape=21)+theme_bw()+theme(axis.text.x  = element_text(angle=0, vjust=0.5))+scale_fill_manual(values=reg_palette)+ylab("Mean d15N per Location")+xlab("Mean d13C per Location")+geom_text(aes(label=Ordered_SITE),hjust=1.5, vjust=0.5,size=3)
dev.off()
```

####5. Map  
```{r map, echo=TRUE}


# Load map packages
library("maps")
library("mapproj")
library("mapplots")
library("mapdata")
library("ggmap")
#don't need all these packages just for this one map, but I use them later for other map
#stuff in the script that I am not including here

#Usage:
#get_map(location = c(lon = -95.3632715, lat = 29.7632836),
#zoom = "auto", scale = "auto", 
#maptype = c("terrain", "terrain-background", "satellite", "roadmap", 
#"hybrid", "toner", "watercolor", "terrain-labels", "terrain-lines", "toner-2010", 
#"toner-2011", "toner-background", "toner-hybrid", "toner-labels", "toner-lines", "toner-lite"), 
#source = c("google", "osm", "stamen", "cloudmade"), 
#force = ifelse(source == "google", TRUE, TRUE), messaging = FALSE, 
#urlonly = FALSE, filename = "ggmapTemp", crop = TRUE, color = c("color", "bw"), language = "en-EN", api_key)

EPGT_latlong<-read.csv("Lat_long_EPGT.csv")
EPGT_latlong$mean_d15N_scale<-EPGT_latlong$mean_d15N*0.4
EPGT_latlong$mean_d15N_scale_1<-EPGT_latlong$mean_d15N*0.75
#Entire Study Region Map
description<-"EPacRegion"
myLocation <- c(-175, -45, -62, 45)
#bounding box lowerleftlon, lowerleftlat, upperrightlon, upperrightlat

myMap <- get_map(location=myLocation, source="google",
                  maptype="hybrid", crop=TRUE) 

pdf(paste(description, "_Gmap", ".pdf",sep=""), width = 11, height = 8.5)
ggmap(myMap) +
  geom_point(aes(x = Longitude, y = Latitude), 
             data = EPGT_latlong, fill = "red", alpha=0.65, 
             size = 6,shape=21)

dev.off()

#SoCal_Baja_inset
description1<-"SoCal-Baja_region"
SoCal_Baja <- c(-121, 22.5, -109, 35)
#bounding box lowerleftlon, lowerleftlat, upperrightlon, upperrightlat

myMap1 <- get_map(location=SoCal_Baja, 
                  source="google", maptype="satellite", crop=TRUE) 

pdf(paste(description1, "_Gmap", ".pdf",sep=""), width = 8, height = 8.5)
ggmap(myMap1) +
  geom_point(aes(x = Longitude, y = Latitude), 
             data = EPGT_latlong,fill = "red", alpha=0.65, 
             size = 16, shape=21)
dev.off()

#Cen-Islands_inset
description2<-"Islands_region"
Islands_region <- c(-100, -10, -75, 11)
#bounding box lowerleftlon, lowerleftlat, upperrightlon, upperrightlat

myMap2 <- get_map(location=Islands_region, 
                  source="google", maptype="satellite", crop=TRUE) 

pdf(paste(description2, "_Gmap", ".pdf",sep=""), width = 8, height = 8.5)
ggmap(myMap2) +
  geom_point(aes(x = Longitude, y = Latitude), 
             data = EPGT_latlong, fill = "red", alpha=0.65,  
             size = 16, shape=21)
dev.off()

#So America Region Map
description3<-"SoAm_Region"
SoAm_Region <- c(-81, -25, -68,-13)
#bounding box lowerleftlon, lowerleftlat, upperrightlon, upperrightlat

myMap3 <- get_map(location=SoAm_Region, 
                  source="google", maptype="satellite", crop=TRUE) 

pdf(paste(description3, "_Gmap", ".pdf",sep=""), width = 8, height = 8.5)
ggmap(myMap3) +
  geom_point(aes(x = Longitude, y = Latitude), 
             data = EPGT_latlong, fill = "red", alpha=0.65, 
             size = 16,shape=21)

dev.off()

```


####6. LMMs and Linear Models   
```{r models, echo=TRUE,,include=TRUE }
#LMM region- Nitrogen
region_Nm1<-lmer(data=data_new2, d15N~Region*CCL_combined+(1|Region/SITE_CODE))#interactive
summary(region_Nm1)
Anova(region_Nm1)

  #including oceanic
  region_Nm2<-lmer(data=data, d15N~Region*CCL_combined+(1|Region/SITE_CODE))#interactive
  summary(region_Nm2)
  Anova(region_Nm2)

#LMM region-Carbon
region_Cm1<-lmer(data=data_new2, d13C~Region*CCL_combined+(1|Region/SITE_CODE))#interactive
summary(region_Cm1)
Anova(region_Cm1)

  #including oceanic
  region_Cm2<-lmer(data=data, d13C~Region*CCL_combined+(1|Region/SITE_CODE))#interactive
  summary(region_Cm2)
  Anova(region_Cm2)

#Linear models-For each region seperately
summary(data_new2$Region)
SC<-subset(data_new2, Region=="SC-BC Pac Coast")     
SC.1<-subset(SC, CCL_combined !="NA")
GC<-subset(data_new2, Region=="Gulf of Cal")
GC.1<-subset(GC, CCL_combined !="NA")
CSC<-subset(data_new2, Region== "Cen-SoAm Pac Coast") 
CSC.1<-subset(CSC, CCL_combined !="NA")
EPI<- subset(data_new2, Region== "EPac Islands")
EPI.1<-subset(EPI, CCL_combined !="NA")

SC_Nm1<-aov(data=SC.1, d15N~Ordered_SITE*CCL_combined)
GC_Nm1<-aov(data=GC.1, d15N~Ordered_SITE*CCL_combined)
CSC_Nm1<-aov(data=CSC.1, d15N~Ordered_SITE*CCL_combined)
EPI_Nm1<-aov(data=EPI.1, d15N~Ordered_SITE*CCL_combined)

summary(SC_Nm1)
par(mfrow=c(2, 1))
plot(SC_Nm1, which=1:2)

#library(dplyr)
#df <- add_rownames(SC.1, "VALUE")

#marked as outside model projections-check these out:
#row 558= LABID 919- this is a SDB turtle that has an abornormally low d15N value (as compared to rest of SDB values-looks more like a Baja sample-tell Jeff to double check this just in case tracable lab error etc.)

#row 659=LABID 2190  looks ok
#row 644=LABID 2187 this is a Magdelena turtle that is the smallest, and has a high d15N value

dev.off()
SC.1$Nresid = resid(SC_Nm1)
ggplot(SC.1,aes(x=CCL_combined,y=Nresid))+geom_point()#one totally offline in this graph is row 558 again
ggplot(SC.1,aes(x=Ordered_SITE,y=Nresid))+geom_boxplot()+geom_point()#same here-558

ggplot(SC.1,aes(x=CCL_combined,y=d15N, color=Ordered_SITE))+geom_point()+geom_smooth(method=lm)#see individual graphs if want to follow up
table(SC.1$Ordered_SITE)#no issue of dropping all from one site missing size

# variance issues btwn SoCal and Baja, trying transformation...commenting out, this made things worse
# SC.1$logdN<-log(SC.1$d15N)
# SC_Nm3<-aov(data=SC.1, logdN~Ordered_SITE*CCL_combined)
# summary(SC_Nm3)
# par(mfrow=c(2, 1))
# plot(SC_Nm3, which=1:2)
# dev.off()
# SC.1$logNresid = resid(SC_Nm3)
# ggplot(SC.1,aes(x=CCL_combined,y=logNresid))+geom_point()
# ggplot(SC.1,aes(x=Ordered_SITE,y=logNresid))+geom_boxplot()+geom_point()

summary(GC_Nm1)
par(mfrow=c(2, 1))
plot(GC_Nm1, which=1:2)
dev.off()
GC.1$Nresid = resid(GC_Nm1)
ggplot(GC.1,aes(x=CCL_combined,y=Nresid))+geom_point()
ggplot(GC.1,aes(x=Ordered_SITE,y=Nresid))+geom_boxplot()+geom_point()
ggplot(GC.1,aes(x=CCL_combined,y=d15N, color=Ordered_SITE))+geom_point()+geom_smooth(method=lm)#see individual graphs if want to follow up
table(GC.1$Ordered_SITE)#no issue
#unequal sample size btwn sites FYI, but otherwise all looks good

summary(CSC_Nm1)
par(mfrow=c(2, 1))
plot(CSC_Nm1, which=1:2)
dev.off()
CSC.1$Nresid = resid(CSC_Nm1)
ggplot(CSC.1,aes(x=CCL_combined,y=Nresid))+geom_point()
ggplot(CSC.1,aes(x=Ordered_SITE,y=Nresid))+geom_boxplot()+geom_point()#come back here-what's up with Chile?

ggplot(CSC.1,aes(x=CCL_combined,y=d15N, color=Ordered_SITE))+geom_point()
table(CSC.1$Ordered_SITE)
#missing size data from Chile drops 1/2 the data points, causes variance fanning-resolves with all the data (but without CCL) (see below)

summary(EPI_Nm1)
par(mfrow=c(2, 1))
plot(EPI_Nm1, which=1:2)
dev.off()
EPI.1$Nresid = resid(EPI_Nm1)
ggplot(EPI.1,aes(x=CCL_combined,y=Nresid))+geom_point()
ggplot(EPI.1,aes(x=Ordered_SITE,y=Nresid))+geom_boxplot()+geom_point()

#CCL significant here, what's going on?
ggplot(EPI.1,aes(x=CCL_combined,y=d15N))+geom_point()+geom_smooth(method=lm)
table(EPI.1$Ordered_SITE)
#missing size data from Chile drops 1/2 the data points, and only DUL has large turtles. send graph to jeff with data tables and let him know about the issue.

#to double check that dropped data in full models (bc CCL data missing from certain sites) isn't influencing site relationships
SC_Nm2<-aov(data=SC, d15N~Ordered_SITE)
GC_Nm2<-aov(data=GC, d15N~Ordered_SITE)
CSC_Nm2<-aov(data=CSC, d15N~Ordered_SITE)
EPI_Nm2<-aov(data=EPI, d15N~Ordered_SITE)

summary(SC_Nm2)
par(mfrow=c(2, 1))
plot(SC_Nm2, which=1:2)
dev.off()
SC$Nresid = resid(SC_Nm2)
ggplot(SC,aes(x=Ordered_SITE,y=Nresid))+geom_boxplot()+geom_point()

summary(GC_Nm2)
par(mfrow=c(2, 1))
plot(GC_Nm2, which=1:2)
dev.off()
GC$Nresid = resid(GC_Nm2)
ggplot(GC,aes(x=Ordered_SITE,y=Nresid))+geom_boxplot()+geom_point()

summary(CSC_Nm2)
par(mfrow=c(2, 1))
plot(CSC_Nm2, which=1:2)
dev.off()
CSC$Nresid = resid(CSC_Nm2)
ggplot(CSC,aes(x=Ordered_SITE,y=Nresid))+geom_boxplot()+geom_point()
#chile resids look much better here bc not dropping data
table(CSC$Ordered_SITE)
ggplot(CSC,aes(x=Ordered_SITE,y=d15N))+geom_boxplot()+geom_point()

summary(EPI_Nm2)
par(mfrow=c(2, 1))
plot(EPI_Nm2, which=1:2)
dev.off()
EPI$Nresid = resid(EPI_Nm2)
ggplot(EPI,aes(x=Ordered_SITE,y=Nresid))+geom_boxplot()+geom_point()

#-------
 #Carbon 
SC_Cm1<-aov(data=SC.1, d13C~Ordered_SITE*CCL_combined)
GC_Cm1<-aov(data=GC.1, d13C~Ordered_SITE*CCL_combined)
CSC_Cm1<-aov(data=CSC.1, d13C~Ordered_SITE*CCL_combined)
EPI_Cm1<-aov(data=EPI.1, d13C~Ordered_SITE*CCL_combined)

SC_Cm2<-aov(data=SC, d13C~Ordered_SITE)
GC_Cm2<-aov(data=GC, d13C~Ordered_SITE)
CSC_Cm2<-aov(data=CSC, d13C~Ordered_SITE)
EPI_Cm2<-aov(data=EPI, d13C~Ordered_SITE)

summary(SC_Cm1)
par(mfrow=c(2, 1))
plot(SC_Cm1, which=1:2)

#row 695: LABID 158129: strong neg residual-SGR sample-corresponds to lowest (=most negative) carbon value in site (see histogram plot)
#row 661: LABID 2180: strong high residual-Magdalena sample-corresponds to highest carbon at BMA (see histogram plot)
#row 657: LABID 2181: strong high residual-Magdalena sample-corresponds to second highest carbon at BMA (see histogram plot)
dev.off()
SC.1$Cresid = resid(SC_Cm1)
ggplot(SC.1,aes(x=CCL_combined,y=Cresid))+geom_point()
ggplot(SC.1,aes(x=Ordered_SITE,y=Cresid))+geom_boxplot()+geom_point()
#same issue as nitrogen of unequal variance btwn SoCal and Baja

ggplot(SC.1,aes(x=CCL_combined,y=d13C, color=Ordered_SITE))+geom_point()
table(SC.1$Ordered_SITE)

summary(GC_Cm1)
par(mfrow=c(2, 1))
plot(GC_Cm1, which=1:2)
#row 436: LABID 54058-BLA - lowest (most negative) carbon value but not that much further out
#row 439: LABID 54053-BLA - seems fine
#row 450: LABID 54033-BLA - seems fine
dev.off()
GC.1$Cresid = resid(GC_Cm1)
ggplot(GC.1,aes(x=CCL_combined,y=Cresid))+geom_point()
ggplot(GC.1,aes(x=Ordered_SITE,y=Cresid))+geom_boxplot()+geom_point()

#df1 <- add_rownames(GC.1, "VALUE")
ggplot(GC.1,aes(x=CCL_combined,y=d13C, color=Ordered_SITE))+geom_point()#fine
table(GC.1$Ordered_SITE)#fine

summary(CSC_Cm1)
par(mfrow=c(2, 1))
plot(CSC_Cm1, which=1:2)
dev.off()
#row 62: LABID 105175
#row 58: LABID 105208
#both from DUL, have lowest carbon values but not crazy outliers so probably nothing going on

CSC.1$Cresid = resid(CSC_Cm1)
ggplot(CSC.1,aes(x=CCL_combined,y=Cresid))+geom_point()
ggplot(CSC.1,aes(x=Ordered_SITE,y=Cresid))+geom_boxplot()+geom_point()
ggplot(CSC.1,aes(x=CCL_combined,y=d13C, color=Ordered_SITE))+geom_point()#same issue of dropping Chile screwing things up
table(CSC.1$Ordered_SITE)

summary(EPI_Cm1)
par(mfrow=c(2, 1))
plot(EPI_Cm1, which=1:2)
dev.off()
EPI.1$Cresid = resid(EPI_Cm1)
ggplot(EPI.1,aes(x=CCL_combined,y=Cresid,color=Ordered_SITE))+geom_point()
ggplot(EPI.1,aes(x=Ordered_SITE,y=Cresid))+geom_boxplot()+geom_point()

ggplot(EPI.1,aes(x=CCL_combined,y=d13C, color=Ordered_SITE))+geom_point()#same issue of dropping Chile screwing things up
table(EPI.1$Ordered_SITE)

summary(SC_Cm2)
par(mfrow=c(2, 1))
plot(SC_Cm2, which=1:2)
dev.off()
SC$Cresid = resid(SC_Cm2)
ggplot(SC,aes(x=Ordered_SITE,y=Cresid))+geom_boxplot()+geom_point()

summary(GC_Cm2)
par(mfrow=c(2, 1))
plot(GC_Cm2, which=1:2)
dev.off()
GC$Cresid = resid(GC_Cm2)
ggplot(GC,aes(x=Ordered_SITE,y=Cresid))+geom_boxplot()+geom_point()

summary(CSC_Cm2)
par(mfrow=c(2, 1))
plot(CSC_Cm2, which=1:2)
dev.off()
CSC$Cresid = resid(CSC_Cm2)
ggplot(CSC,aes(x=Ordered_SITE,y=Cresid))+geom_boxplot()+geom_point() #moderate fanning, not sure if issue

summary(EPI_Cm2)
par(mfrow=c(2, 1))
plot(EPI_Cm2, which=1:2)
dev.off()
EPI$Cresid = resid(EPI_Cm2)
ggplot(EPI,aes(x=Ordered_SITE,y=Cresid))+geom_boxplot()+geom_point()

#Corresponding visuals
#Nitrogen

pdf("nitrogen_faceted_scatter.pdf", 12, 8)
N1<-ggplot(data_new2, aes(x=CCL_combined,y=d15N, fill=Ordered_SITE)) + geom_point(size=3, alpha=.8,shape=21,position=position_jitter(width=.5,height=.5))+theme_bw()+theme(axis.text.x  = element_text(angle=90, vjust=0.5))+geom_smooth(method=lm)+scale_fill_manual(values=pal1)
N1+facet_wrap( ~ Region, ncol=2)
dev.off()

pdf("carbon_faceted_scatter.pdf", 12, 8)
C1<-ggplot(data_new2, aes(x=CCL_combined,y=d13C, fill=Ordered_SITE)) + geom_point(size=3, alpha=.8,shape=21,position=position_jitter(width=.5,height=.5))+theme_bw()+theme(axis.text.x  = element_text(angle=90, vjust=0.5))+geom_smooth(method=lm)+scale_fill_manual(values=pal1)
C1+facet_wrap( ~ Region, ncol=2)
dev.off()
```

[1]: http://docs.ggplot2.org/current/stat_ellipse.html